<!DOCTYPE html>
<html>
<head>
  <style>
    html,
    body {
      margin: 0;
      overflow: hidden;
      height: 100%;
      background: black;
    }

    canvas[resize] {
      width: 100%;
      height: 100%;
    }
  </style>

  <script type="text/javascript" src="js/paperjs-v0.10.2/dist/paper-full.js"></script>
  <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
  <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
  <script type="text/javascript" src="js/hacknode_graphics.js"></script>
  
  <script type="text/javascript">
      paper.install(window);

      var socket = io('http://localhost:7000');

      // Only execute our code once the DOM is ready.
      window.onload = function () {
          
          // Get a reference to the canvas object
          var canvas = document.getElementById('myCanvas');
          // Create an empty project and a view for the canvas:
          paper.setup(canvas);

          // TODO: eliminate makeNode
          function makeNode(x, y, size, color) {
              var node = new Node(x, y, size, color);
              console.log(x, y, size, color);

              node.onMouseDown = function (event) {
                  if (this.owned) {
                      // if this is a node we own, allow selection or deselection
                      this.selected = !(this.selected);
                  }
              } // end onMouseDown
              return node;
          } // end MakeNode

          socket.emit('message', '/user hacktestuser password');
          
          //Draw a node when we get message "Node"
          socket.on('message', function (msg) {
            console.log("message: " + msg);
            if(msg.includes('Node')){
              var str = msg.split(" ");
              var x = parseInt(str[1]);
              var y = parseInt(str[2]);
              var r = parseInt(str[3]);
              var c = str[4];
              //nodes[0] = makeNode(str[1], str[2], str[3], str[4]);
              nodes[0] = makeNode(x, y, r, c);
              //nodes[0].owned = true;
              console.log(x, y, r, c);
              connectNodes()
            }
          });
         //#e8e8e8
          socket.on('error_message', function (msg) {
            console.log("socket error: " + msg);
          });

          view.onFrame = function (event) {
              // event.count is the number of times the frame event has been fired
              if (event.count % 60 == 0) { // 60 frames per second

              } // end if
          } //end onFrame

          // Draw the view now:
          view.draw();
          
      } //end OnLoad
  </script>
</head>

<body>
<canvas id="myCanvas" resize></canvas>
</body>
</html>
