<!DOCTYPE html>
<html>
<head>
  <style>
    html,
    body {
      margin: 0;
      overflow: hidden;
      height: 100%;
      background: black;
    }

    canvas[resize] {
      width: 100%;
      height: 100%;
    }
  </style>
  <link rel="stylesheet" type="text/css" href="styles.css">

  <script type="text/javascript" src="js/paperjs-v0.10.2/dist/paper-full.js"></script>
  <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
  <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
  <script type="text/javascript" src="js/hacknode_graphics.js"></script>

  
  <script type="text/javascript">
      var socket = io('http://localhost:7000');

      $('#loginForm').css("visibility: visible;");

      socket.on('error_message', function (msg) {
          $('#messages').append($('<p class="chat_error"></p>').text(msg));
      });


      socket.on('message', function (msg) {
          console.log("message: " + msg);
          if(msg.startsWith("Login Successful"));
            // take down login form
              $('#loginForm').hide();
              // go to next page

      });

      function clicker() {
              socket.emit('message', '/user ' + $('#usernameinput').val() + $('#passwordinput').val() );


      };

      function page2() {

          $('#page2').show();

          var value = 0;

          setInterval(function () {
              value++;
              document.getElementById("pster").innerHTML = value;
          }, 1000);

      }
      




      paper.install(window);
      
      var nodes = new Map();
      var connections = new Map();
      
      $('#loginForm form').submit(function () {
            $('#loginForm').css("visibility: invisible;");
              socket.emit(
                 'message', 
                   '/user ' + $('#usernameinput').val() + " " + $('#passwordinput').val()
              );
              return false;
            console.log('its working');
          });


      
      



      // Only execute our code once the DOM is ready.
      window.onload = function() {
          
          // Get a reference to the canvas object
          var canvas = $('#myCanvas');
          // Create an empty project and a view for the canvas:
          paper.setup(canvas);
          canvas.css("visibility: hidden;");


          socket.emit('sync', 'all');

          socket.on('sync', function (msg) {
              console.log("got sync");

              // parse the JSON into an object
              var network = JSON.parse(msg);
              console.log(network);
              console.log(network.description);
              console.log("Number of nodes in network: " + network.nodes.length);

              // loop through the nodes in the network object and create them
              for(i=0;i< network.nodes.length;i++){
                  var node = network.nodes[i];
                  nodes.set(node.id, new Node(node.x, node.y, node.r, node.baseColor));
                  node.onMouseDown = function (event) {
                    if (this.owned) {
                        this.selected = !(this.selected);
                    }
                  } // end onMouseDown
              }

              // loop through the connections in the network object and create them
              for (i = 0; i < network.connections.length; i++) {
                  var connection = network.connections[i];
                  node1 = nodes.get(connection.node1); //findNode(connection.node1);
                  node2 = nodes.get(connection.node2); //findNode(connection.node2);
                  if(node1 != null && node2 != null) {
                      connections.set(connection.id, connectNodes(node1, node2));
                  }
              }
          }); // end on sync



          view.onFrame = function (event) {
              // event.count is the number of times the frame event has been fired
              if (event.count % 60 == 0) { // 60 frames per second

              } // end if
          } //end onFrame

          // Draw the view now:
          view.draw();
          
      } //end OnLoad
  </script>
</head>

<body>

<div id="loginForm">
    <p id="pagetitle">Login</p>
    <form action="">
        <div class="form-field">
        <label id="usernametext">username:</label>
        <input id="usernameinput">
        </div>

        <div class="form-field">
        <label id="passwordtext">password:</label>
        <input id="passwordinput">
        </div>

        <button class="sidemenu_theme" type="button" id="loginbtn" onclick="clicker()">login</button>
    </form>
</div>

<canvas id="myCanvas" resize></canvas>
<div id="messages" style="color:white;"></div>

</body>
</html>
